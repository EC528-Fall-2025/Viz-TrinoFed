import{j as e}from"./jsx-runtime-BjG_zV1W.js";import{r as T}from"./index-DpTt3J-R.js";import{c as W}from"./fixtures-BzLkDzPP.js";const j=({query:h})=>{var u;const[m,v]=T.useState(0),a=((u=h.events)==null?void 0:u.filter(t=>t.statistics))||[];if(a.length===0)return null;const i=a[m].statistics,l=t=>{if(!t||t===0)return"0 B";const s=t/1024;if(s<1024)return`${s.toFixed(2)} KB`;const r=s/1024;return r<1024?`${r.toFixed(2)} MB`:`${(r/1024).toFixed(2)} GB`},n=t=>!t&&t!==0?"N/A":t.toLocaleString(),o=t=>{if(!t&&t!==0)return"N/A";if(t<1)return`${(t*1e3).toFixed(2)} ms`;if(t<60)return`${t.toFixed(2)} s`;const s=Math.floor(t/60),r=(t%60).toFixed(2);return`${s}m ${r}s`},p=(t,s,r,d)=>e.jsxs("div",{style:{backgroundColor:"white",padding:"12px",borderRadius:"8px",border:`2px solid ${d}`,boxShadow:"0 2px 4px rgba(0,0,0,0.05)"},children:[e.jsxs("div",{style:{fontSize:"11px",color:"#6c757d",marginBottom:"4px"},children:[e.jsx("span",{style:{marginRight:"4px"},children:r}),t]}),e.jsx("div",{style:{fontSize:"18px",fontWeight:"bold",color:d},children:s})]}),c=(t,s,r)=>e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsxs("div",{style:{fontWeight:"600",fontSize:"13px",marginBottom:"10px",color:"#495057",borderBottom:"2px solid #e9ecef",paddingBottom:"6px",display:"flex",alignItems:"center",gap:"6px"},children:[e.jsx("span",{children:s}),e.jsx("span",{children:t})]}),r]}),b=(t,s)=>!t||t.length===0?null:e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("div",{style:{fontSize:"12px",fontWeight:"600",marginBottom:"6px",color:"#495057"},children:s}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:"8px",fontSize:"10px"},children:t.slice(0,9).map((r,d)=>e.jsxs("div",{style:{padding:"6px",backgroundColor:"#f8f9fa",borderRadius:"4px",textAlign:"center"},children:[e.jsxs("div",{style:{color:"#6c757d",marginBottom:"2px"},children:["P",r.percentile||d]}),e.jsx("div",{style:{fontWeight:"bold",color:"#212529"},children:o(r.value)})]},d))})]}),S=t=>!t||t.length===0?null:e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("div",{style:{fontSize:"12px",fontWeight:"600",marginBottom:"8px",color:"#495057"},children:"Operator Performance"}),e.jsx("div",{style:{maxHeight:"300px",overflow:"auto"},children:t.slice(0,10).map((s,r)=>e.jsxs("div",{style:{padding:"10px",marginBottom:"8px",backgroundColor:"#f8f9fa",borderRadius:"6px",borderLeft:"4px solid #1971c2"},children:[e.jsxs("div",{style:{fontWeight:"bold",fontSize:"11px",marginBottom:"6px",color:"#212529"},children:[s.operatorType||`Operator ${r+1}`,s.planNodeId&&e.jsxs("span",{style:{color:"#6c757d",marginLeft:"8px",fontWeight:"normal"},children:["(Node: ",s.planNodeId,")"]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"6px",fontSize:"10px"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{color:"#6c757d"},children:"Input: "}),e.jsxs("span",{style:{fontWeight:"bold"},children:[n(s.inputPositions)," rows"]})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"#6c757d"},children:"Output: "}),e.jsxs("span",{style:{fontWeight:"bold"},children:[n(s.outputPositions)," rows"]})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"#6c757d"},children:"CPU: "}),e.jsx("span",{style:{fontWeight:"bold"},children:s.addInputCpu?o(parseFloat(s.addInputCpu)/1e9):"N/A"})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"#6c757d"},children:"Blocked: "}),e.jsx("span",{style:{fontWeight:"bold"},children:s.blockedWall?o(parseFloat(s.blockedWall)/1e9):"N/A"})]})]})]},r))})]}),B=t=>!t||t.length===0?null:e.jsxs("div",{style:{marginBottom:"12px"},children:[e.jsx("div",{style:{fontSize:"12px",fontWeight:"600",marginBottom:"8px",color:"#495057"},children:"Task Distribution"}),e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"8px"},children:t.slice(0,6).map((s,r)=>e.jsxs("div",{style:{padding:"8px",backgroundColor:"#f8f9fa",borderRadius:"6px",fontSize:"10px"},children:[e.jsxs("div",{style:{fontWeight:"bold",marginBottom:"4px",color:"#212529"},children:["Task ",r+1]}),e.jsxs("div",{style:{color:"#6c757d"},children:[s.totalDrivers&&e.jsxs("div",{children:["Drivers: ",s.totalDrivers]}),s.cumulativeUserMemory&&e.jsxs("div",{children:["Memory: ",l(s.cumulativeUserMemory)]})]})]},r))})]});return e.jsxs("div",{style:{position:"absolute",top:10,right:10,zIndex:10,backgroundColor:"white",padding:"16px 20px",borderRadius:"12px",boxShadow:"0 4px 16px rgba(0,0,0,0.15)",maxWidth:"500px",maxHeight:"85vh",overflow:"auto",fontSize:"12px",borderRight:"5px solid #1971c2",marginRight:"60px"},children:[e.jsx("div",{style:{fontWeight:"bold",marginBottom:"16px",fontSize:"18px",color:"#212529",display:"flex",alignItems:"center",justifyContent:"space-between"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[e.jsx("span",{children:"ðŸ“ˆ"}),e.jsx("span",{children:"Detailed Statistics"})]})}),a.length>1&&e.jsxs("div",{style:{marginBottom:"16px"},children:[e.jsx("div",{style:{fontSize:"11px",color:"#6c757d",marginBottom:"6px"},children:"Select Event"}),e.jsx("select",{value:m,onChange:t=>v(Number(t.target.value)),style:{width:"100%",padding:"8px",borderRadius:"6px",border:"1px solid #dee2e6",fontSize:"12px",backgroundColor:"white"},children:a.map((t,s)=>e.jsxs("option",{value:s,children:[t.eventType," - ",t.state," (",t.timestamp,")"]},s))})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"10px",marginBottom:"16px"},children:[p("CPU Time",o(i.cpuTime),"ðŸ–¥ï¸","#1971c2"),p("Wall Time",o(i.wallTime),"â°","#2b8a3e"),p("Queued Time",o(i.queuedTime),"â³","#f08c00"),p("Peak Memory",l(i.peakUserMemoryBytes),"ðŸ§ ","#9c36b5")]}),c("Data Flow","ðŸ“Š",e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, 1fr)",gap:"8px"},children:[e.jsxs("div",{style:{padding:"8px",backgroundColor:"#f8f9fa",borderRadius:"6px"},children:[e.jsx("div",{style:{fontSize:"10px",color:"#6c757d"},children:"Physical Input"}),e.jsxs("div",{style:{fontWeight:"bold",fontSize:"14px",color:"#1971c2"},children:[n(i.physicalInputRows)," rows"]}),e.jsx("div",{style:{fontSize:"10px",color:"#868e96"},children:l(i.physicalInputBytes)})]}),e.jsxs("div",{style:{padding:"8px",backgroundColor:"#f8f9fa",borderRadius:"6px"},children:[e.jsx("div",{style:{fontSize:"10px",color:"#6c757d"},children:"Processed Input"}),e.jsxs("div",{style:{fontWeight:"bold",fontSize:"14px",color:"#2b8a3e"},children:[n(i.processedInputRows)," rows"]}),e.jsx("div",{style:{fontSize:"10px",color:"#868e96"},children:l(i.processedInputBytes)})]}),e.jsxs("div",{style:{padding:"8px",backgroundColor:"#f8f9fa",borderRadius:"6px"},children:[e.jsx("div",{style:{fontSize:"10px",color:"#6c757d"},children:"Output"}),e.jsxs("div",{style:{fontWeight:"bold",fontSize:"14px",color:"#f08c00"},children:[n(i.outputRows)," rows"]}),e.jsx("div",{style:{fontSize:"10px",color:"#868e96"},children:l(i.outputBytes)})]}),e.jsxs("div",{style:{padding:"8px",backgroundColor:"#f8f9fa",borderRadius:"6px"},children:[e.jsx("div",{style:{fontSize:"10px",color:"#6c757d"},children:"Completed Splits"}),e.jsx("div",{style:{fontWeight:"bold",fontSize:"14px",color:"#9c36b5"},children:n(i.completedSplits)})]})]})),i.cpuTimeDistribution&&c("CPU Time Distribution","â±ï¸",b(i.cpuTimeDistribution,"Percentiles")),i.operatorSummaries&&c("Operator Summaries","âš™ï¸",S(i.operatorSummaries)),i.taskStatistics&&c("Task Statistics","ðŸ“¦",B(i.taskStatistics)),c("Additional Metrics","ðŸ“‹",e.jsx("div",{style:{fontSize:"11px"},children:e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"6px",marginBottom:"8px"},children:[e.jsxs("div",{children:[e.jsx("span",{style:{color:"#6c757d"},children:"Scheduled Time: "}),e.jsx("span",{style:{fontWeight:"bold"},children:o(i.scheduledTime)})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"#6c757d"},children:"Analysis Time: "}),e.jsx("span",{style:{fontWeight:"bold"},children:o(i.analysisTime)})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"#6c757d"},children:"Planning Time: "}),e.jsx("span",{style:{fontWeight:"bold"},children:o(i.planningTime)})]}),e.jsxs("div",{children:[e.jsx("span",{style:{color:"#6c757d"},children:"Cumulative Memory: "}),e.jsx("span",{style:{fontWeight:"bold"},children:l(i.cumulativeMemory)})]}),i.spilledBytes>0&&e.jsxs("div",{style:{gridColumn:"1 / -1"},children:[e.jsx("span",{style:{color:"#c92a2a",fontWeight:"bold"},children:"Spilled Data: "}),e.jsx("span",{style:{fontWeight:"bold"},children:l(i.spilledBytes)})]})]})}))]})};j.__docgenInfo={description:"",methods:[],displayName:"StatisticsPanel",props:{query:{required:!0,tsType:{name:"QueryTree"},description:""}}};const I={title:"Components/StatisticsPanel",component:j,decorators:[h=>e.jsx("div",{style:{position:"relative",width:"100%",minHeight:"600px",backgroundColor:"#f1f3f5",padding:"2rem"},children:e.jsx(h,{})})],args:{query:W}},x={};var f,g,y;x.parameters={...x.parameters,docs:{...(f=x.parameters)==null?void 0:f.docs,source:{originalSource:"{}",...(y=(g=x.parameters)==null?void 0:g.docs)==null?void 0:y.source}}};const R=["Default"];export{x as Default,R as __namedExportsOrder,I as default};
